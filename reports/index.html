<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DOSepranza — Report UAT</title>
  <link rel="icon" href="https://i.postimg.cc/L6H20zfp/logo-dosepranza-People-About-Food.png">
  <link rel="stylesheet" href="/reports/reports.css" />
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <div>
          <h1 class="title">Report UAT — DOSepranza</h1>
          <div class="muted">Dashboard report con filtri</div>
        </div>
        <a class="btn" href="/.netlify/functions/report?key=reports/latest.pdf">Ultimo PDF</a>
      </div>

      <div class="kpis">
        <div class="kpi"><div class="muted">Report totali</div><strong id="kpi-total">0</strong></div>
        <div class="kpi"><div class="muted">Pass rate</div><strong id="kpi-pass">0%</strong></div>
        <div class="kpi"><div class="muted">Ultimo report</div><strong id="kpi-last">-</strong></div>
        <div class="kpi"><div class="muted">Ultimi 7 giorni</div><strong id="kpi-7d">0</strong></div>
      </div>

      <div class="panel">
        <div class="muted">Trend ultime 8 settimane</div>
        <svg id="trend-chart" class="chart" viewBox="0 0 800 120" preserveAspectRatio="none"></svg>
      </div>

      <div class="panel">
        <div class="muted">Severity map (ultimi report)</div>
        <div class="legend">
          <span><i class="dot high"></i>High</span>
          <span><i class="dot medium"></i>Medium</span>
          <span><i class="dot low"></i>Low</span>
        </div>
        <svg id="severity-chart" class="chart" viewBox="0 0 800 120" preserveAspectRatio="none"></svg>
      </div>

      <div class="controls">
        <input id="filter-q" type="text" placeholder="Cerca per etichetta" />
        <input id="filter-from" type="date" />
        <input id="filter-to" type="date" />
        <label class="muted" style="display:flex; align-items:center; gap:6px;">
          <input id="filter-high" type="checkbox" />
          Solo High
        </label>
        <button id="filter-btn" class="btn">Filtra</button>
      </div>

      <div id="auto-wrap" class="muted" style="display:none; margin-bottom:10px;">
        <label><input id="auto-refresh" type="checkbox" /> Auto‑refresh (solo admin)</label>
      </div>

      <div class="panel audit" id="audit-panel" style="display:none;">
        <div class="muted">Accessi recenti (admin)</div>
        <div style="margin:8px 0;">
          <button id="audit-export" class="btn" type="button">Export Audit CSV</button>
          <button id="audit-export-json" class="btn" type="button">Export Audit JSON</button>
        </div>
        <div id="audit-list"></div>
      </div>

      <div id="reports-list" class="list"></div>

      <div class="panel" id="fail-panel" style="display:none;">
        <div class="muted">Fail reasons (ultimi)</div>
        <div id="fail-list"></div>
      </div>

      <div class="panel" id="fail-detail-panel" style="display:none;">
        <div class="muted">Top failing tests (stacktrace)</div>
        <div id="fail-detail"></div>
      </div>

      <div class="panel" id="flaky-panel" style="display:none;">
        <div class="muted">Flaky tests (admin)</div>
        <div id="flaky-list"></div>
      </div>

      <div class="panel">
        <div class="muted">Weekly aggregate</div>
        <div id="weekly-list"></div>
      </div>

      <div id="stack-modal" class="fixed inset-0 bg-gray-900/80 flex items-center justify-center z-[200] hidden p-4">
        <div class="bg-white p-6 rounded-2xl w-full max-w-2xl">
          <h3 class="text-lg font-black mb-2">Stacktrace</h3>
          <pre id="stack-content" class="stack"></pre>
          <div class="text-right mt-3">
            <button id="stack-close" class="btn">Chiudi</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="/reports/reports.js"></script>
</body>
</html>
